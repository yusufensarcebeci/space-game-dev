{"version":3,"sources":["file:///D:/CocosProjects/bionluk/muratcanko/SpaceGame/SpaceGame3D/assets/scripts/JoystickController.ts"],"names":["_decorator","Component","Node","UITransform","Vec3","ccclass","property","JoystickController","Number","direction","joystickCenter","getDirection","onLoad","node","on","EventType","TOUCH_MOVE","handleTouchMove","TOUCH_END","resetJoystickPosition","TOUCH_CANCEL","event","screenPos","getUILocation","uiTransform","getComponent","pos","convertToNodeSpaceAR","x","y","offset","distance","length","joystickRadius","normalize","multiplyScalar","stick","setPosition","set"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, Node, UITransform, Vec3 } from \"cc\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"JoystickController\")\r\nexport class JoystickController extends Component {\r\n  @property(Node) stick: Node = null;\r\n  @property(Number) joystickRadius: number = 100;\r\n\r\n  private direction: Vec3 = new Vec3(0, 0, 0);\r\n  private joystickCenter: Vec3 = new Vec3(0, 0, 0);\r\n\r\n  public getDirection(): Vec3 {\r\n    return this.direction;\r\n  }\r\n\r\n  onLoad() {\r\n    this.node.on(Node.EventType.TOUCH_MOVE, this.handleTouchMove, this);\r\n    this.node.on(Node.EventType.TOUCH_END, this.resetJoystickPosition, this);\r\n    this.node.on(Node.EventType.TOUCH_CANCEL, this.resetJoystickPosition, this);\r\n  }\r\n\r\n  private handleTouchMove(event: EventTouch) {\r\n    const screenPos = event.getUILocation();\r\n    const uiTransform = this.node.getComponent(UITransform);\r\n\r\n    const pos = uiTransform.convertToNodeSpaceAR(\r\n      new Vec3(screenPos.x, screenPos.y, 0)\r\n    );\r\n\r\n    const offset = new Vec3(\r\n      pos.x - this.joystickCenter.x,\r\n      pos.y - this.joystickCenter.y,\r\n      0\r\n    );\r\n\r\n    const distance = offset.length();\r\n    if (distance > this.joystickRadius) {\r\n      offset.normalize().multiplyScalar(this.joystickRadius);\r\n    }\r\n\r\n    this.stick.setPosition(\r\n      this.joystickCenter.x + offset.x,\r\n      this.joystickCenter.y + offset.y,\r\n      0\r\n    );\r\n\r\n    // Yön bilgisini normalize ederek güncelle\r\n    if (distance > 0) {\r\n      this.direction.set(\r\n        offset.x / this.joystickRadius,\r\n        offset.y / this.joystickRadius,\r\n        0\r\n      );\r\n    } else {\r\n      this.direction.set(0, 0, 0);\r\n    }\r\n  }\r\n\r\n  private resetJoystickPosition(event: EventTouch) {\r\n    this.stick.setPosition(this.joystickCenter);\r\n    this.direction.set(0, 0, 0);\r\n  }\r\n}\r\n"]}