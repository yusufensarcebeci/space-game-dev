{"version":3,"sources":["file:///D:/CocosProjects/bionluk/muratcanko/SpaceGame/SpaceGame3D/assets/scripts/JoystickController.ts"],"names":["_decorator","Component","Node","UITransform","Vec3","ccclass","property","JoystickController","Number","joystickCenter","onLoad","console","log","node","name","getPosition","on","EventType","TOUCH_MOVE","handleTouchMove","TOUCH_END","resetJoystickPosition","TOUCH_CANCEL","event","screenPos","getDelta","uiTransform","getComponent","nodePos","convertToNodeSpaceAR","x","y","stickPos","stick","setPosition"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAuBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;;;;;;;;;OACzD;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;;oCAGjBO,kB,WADZF,OAAO,CAAC,oBAAD,C,UAELC,QAAQ,CAACJ,IAAD,C,UACRI,QAAQ,CAACJ,IAAD,C,UACRI,QAAQ,CAACE,MAAD,C,2BAJX,MACaD,kBADb,SACwCN,SADxC,CACkD;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAIhDQ,cAJgD;AAAA;;AAMhDC,QAAAA,MAAM,GAAG;AACPC,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAKC,IAAL,CAAUC,IAAtB;AACA,eAAKL,cAAL,GAAsB,KAAKI,IAAL,CAAUE,WAAV,EAAtB;AACA,eAAKF,IAAL,CAAUG,EAAV,CAAad,IAAI,CAACe,SAAL,CAAeC,UAA5B,EAAwC,KAAKC,eAA7C,EAA8D,IAA9D;AACA,eAAKN,IAAL,CAAUG,EAAV,CAAad,IAAI,CAACe,SAAL,CAAeG,SAA5B,EAAuC,KAAKC,qBAA5C,EAAmE,IAAnE;AACA,eAAKR,IAAL,CAAUG,EAAV,CAAad,IAAI,CAACe,SAAL,CAAeK,YAA5B,EAA0C,KAAKD,qBAA/C,EAAsE,IAAtE;AACD;;AAEOF,QAAAA,eAAe,CAACI,KAAD,EAAoB;AACzC,cAAMC,SAAS,GAAGD,KAAK,CAACE,QAAN,EAAlB;AACA,cAAMC,WAAW,GAAG,KAAKb,IAAL,CAAUc,YAAV,CAAuBxB,WAAvB,CAApB;AAGA,cAAMyB,OAAO,GAAGF,WAAW,CAACG,oBAAZ,CAAiC,IAAIzB,IAAJ,CAASoB,SAAS,CAACM,CAAnB,EAAsBN,SAAS,CAACO,CAAhC,EAAmC,CAAnC,CAAjC,CAAhB;AAGA,cAAMC,QAAQ,GAAG,IAAI5B,IAAJ,CAASwB,OAAO,CAACE,CAAR,GAAY,KAAKrB,cAAL,CAAoBqB,CAAzC,EAA4CF,OAAO,CAACG,CAAR,GAAY,KAAKtB,cAAL,CAAoBsB,CAA5E,EAA+E,CAA/E,CAAjB;AACA,eAAKE,KAAL,CAAWC,WAAX,CAAuBF,QAAvB;AACD;;AACOX,QAAAA,qBAAqB,CAACE,KAAD,EAAoB;AAC/C,eAAKU,KAAL,CAAWC,WAAX,CAAuB,KAAKzB,cAA5B;AACD;;AA3B+C,O;;;;;iBACjB,I;;;;;;;iBACD,I;;;;;;;iBACa,G;;kCA0B7C;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["import { _decorator, Component, EventTouch, Node, UITransform, Vec3 } from \"cc\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"JoystickController\")\r\nexport class JoystickController extends Component {\r\n  @property(Node) player: Node = null;\r\n  @property(Node) stick: Node = null;\r\n  @property(Number) joystickRadius: number = 100;\r\n  joystickCenter: Vec3;\r\n\r\n  onLoad() {\r\n    console.log(this.node.name);\r\n    this.joystickCenter = this.node.getPosition();\r\n    this.node.on(Node.EventType.TOUCH_MOVE, this.handleTouchMove, this);\r\n    this.node.on(Node.EventType.TOUCH_END, this.resetJoystickPosition, this);\r\n    this.node.on(Node.EventType.TOUCH_CANCEL, this.resetJoystickPosition, this);\r\n  }\r\n\r\n  private handleTouchMove(event: EventTouch) {\r\n    const screenPos = event.getDelta(); \r\n    const uiTransform = this.node.getComponent(UITransform);\r\n\r\n    \r\n    const nodePos = uiTransform.convertToNodeSpaceAR(new Vec3(screenPos.x, screenPos.y, 0));\r\n    \r\n    \r\n    const stickPos = new Vec3(nodePos.x - this.joystickCenter.x, nodePos.y - this.joystickCenter.y, 0);\r\n    this.stick.setPosition(stickPos);\r\n  }\r\n  private resetJoystickPosition(event: EventTouch) {\r\n    this.stick.setPosition(this.joystickCenter);\r\n  }\r\n}\r\n// const offset = new Vec3(\r\n//   pos.x - this.joystickCenter.x,\r\n//   pos.y - this.joystickCenter.y,\r\n//   0\r\n// );\r\n// const distance = offset.length();\r\n\r\n// if (distance > this.joystickRadius) {\r\n//   offset.normalize().multiplyScalar(this.joystickRadius);\r\n//   pos.set(\r\n//     this.joystickCenter.x + offset.x,\r\n//     this.joystickCenter.y + offset.y,\r\n//     0\r\n//   );\r\n// }\r\n"]}